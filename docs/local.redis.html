<!DOCTYPE html>  <html> <head>   <title>local.redis.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               local.redis.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Authors: Joel Kemp and Eudis Duran
File:    local.redis.js
Purpose: Replicates the Redis API for use with HTML5 Storage Objects
Usage:   window.localRedis along with any supported commands.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;localStorage&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">aKeys</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">oStorage</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">oStorage</span><span class="p">,</span> <span class="s2">&quot;getItem&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sKey</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sKey</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">sKey</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span> <span class="p">},</span>
        <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">});</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">oStorage</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nKeyId</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">aKeys</span><span class="p">[</span><span class="nx">nKeyId</span><span class="p">];</span> <span class="p">},</span>
        <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">});</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">oStorage</span><span class="p">,</span> <span class="s2">&quot;setItem&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sKey</span><span class="p">,</span> <span class="nx">sValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">sKey</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">sKey</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">sValue</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/&quot;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">});</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">oStorage</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">aKeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">},</span>
        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">});</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">oStorage</span><span class="p">,</span> <span class="s2">&quot;removeItem&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sKey</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">sKey</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">sKey</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/&quot;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iThisIndx</span><span class="p">,</span> <span class="nx">sKey</span><span class="p">,</span> <span class="nx">aCouple</span><span class="p">,</span> <span class="nx">aCouples</span><span class="p">,</span> <span class="nx">iKey</span><span class="p">,</span> <span class="nx">nIdx</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">sKey</span> <span class="k">in</span> <span class="nx">oStorage</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">iThisIndx</span> <span class="o">=</span> <span class="nx">aKeys</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">sKey</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">iThisIndx</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">oStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">sKey</span><span class="p">,</span> <span class="nx">oStorage</span><span class="p">[</span><span class="nx">sKey</span><span class="p">]);</span> <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span> <span class="nx">aKeys</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">iThisIndx</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
          <span class="k">delete</span> <span class="nx">oStorage</span><span class="p">[</span><span class="nx">sKey</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">aKeys</span><span class="p">;</span> <span class="nx">aKeys</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">aKeys</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span> <span class="nx">oStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">aKeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">aCouple</span><span class="p">,</span> <span class="nx">iKey</span><span class="p">,</span> <span class="nx">nIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">aCouples</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s*;\s*/</span><span class="p">);</span> <span class="nx">nIdx</span> <span class="o">&lt;</span> <span class="nx">aCouples</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">nIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">aCouple</span> <span class="o">=</span> <span class="nx">aCouples</span><span class="p">[</span><span class="nx">nIdx</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s*=\s*/</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">aCouple</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">oStorage</span><span class="p">[</span><span class="nx">iKey</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">unescape</span><span class="p">(</span><span class="nx">aCouple</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">unescape</span><span class="p">(</span><span class="nx">aCouple</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="nx">aKeys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">iKey</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">oStorage</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">configurable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">enumerable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">})());</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">JSON</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">parse</span><span class="o">:</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">decode</span><span class="p">)</span> <span class="o">||</span>
        <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">evalJSON</span> <span class="o">&amp;&amp;</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">evalJSON</span><span class="p">();},</span>
    <span class="nx">stringify</span><span class="o">:</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">||</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">encode</span><span class="p">)</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Break if no JSON support was found</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="o">&amp;&amp;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">)){</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;No JSON support found&#39;</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="kd">var</span> <span class="nx">storage</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">,</span>
      <span class="nx">localRedis</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>/////////////////////////
Utilities
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span>
      <span class="nx">isString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">element</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">isNumber</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">element</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">stringified</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">?</span> <span class="nx">element</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">parsed</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>If it's a literal string, parsing will fail</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">element</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>We couldn't parse the literal string
so just return the literal in the finally block.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Used to emit cross-browser events
Note: Checks for IE support, then Jquery, then other browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">eventName</span> <span class="o">=</span> <span class="s1">&#39;storagechange&#39;</span><span class="p">,</span>
      <span class="nx">fireEvent</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">evt</span><span class="p">,</span>
            <span class="nx">$</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">$</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>dispatch for IE</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createEventObject</span><span class="p">){</span>
            <span class="nx">evt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEventObject</span><span class="p">();</span>
            <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>If jQuery exists, dispatch with jquery</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>dispatch for firefox + others</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
          <span class="nx">evt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s2">&quot;HTMLEvents&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>event type, bubbling, cancelable</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">evt</span><span class="p">.</span><span class="nx">initEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="k">return</span> <span class="o">!</span><span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Fired when the storage changes
Attaches events to the document to avoid</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">fireStorageChangedEvent</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fireEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;storagechange&#39;</span><span class="p">);</span>
      <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>/////////////////////////
Error Helper
TODO: MOVE TO EXTERNAL PLUGIN
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span>
      <span class="nx">errors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;wrong number of arguments&#39;</span><span class="p">,</span>
        <span class="s1">&#39;non-string value&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value is not an integer or out of range&#39;</span><span class="p">,</span>
        <span class="s1">&#39;not a string value&#39;</span><span class="p">,</span>
        <span class="s1">&#39;timestamp already passed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;delay not convertible to a number&#39;</span><span class="p">,</span>
        <span class="s1">&#39;source and destination objects are the same&#39;</span><span class="p">,</span>
        <span class="s1">&#39;no such key&#39;</span><span class="p">,</span>
        <span class="s1">&#39;missing storage context&#39;</span>
      <span class="p">],</span>

      <span class="nx">generateError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span> <span class="cm">/*, functionName, errorType */</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">error</span><span class="p">,</span>
            <span class="nx">message</span><span class="p">,</span>
            <span class="nx">functionName</span>  <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="nx">errorType</span>     <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;number&#39;</span> <span class="o">||</span> <span class="p">(</span><span class="nx">functionName</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">functionName</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;wrong arg types&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">message</span> <span class="o">=</span> <span class="nx">errors</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">errorType</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">errorType</span> <span class="o">=</span> <span class="nx">errorType</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">errorType</span> <span class="o">===</span> <span class="s1">&#39;typeerror&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">error</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">error</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
      <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>/////////////////////////
Expiration Internals
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Creates and returns the expiration key format for a given storage key</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">createExpirationKey</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">delimiter</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span>
            <span class="nx">prefix</span>    <span class="o">=</span> <span class="s2">&quot;e&quot;</span><span class="p">;</span>

        <span class="nx">key</span> <span class="o">=</span> <span class="nx">stringified</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">delimiter</span> <span class="o">+</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Creates the expiration value/data format for an expiration
event's ID and millisecond delay
Returns: A string representation of an object created from the data
Note:    Keys are as short as possible to save space when stored</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">createExpirationValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">delay</span><span class="p">,</span> <span class="nx">currentTime</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stringified</span><span class="p">({</span>
          <span class="nx">c</span><span class="o">:</span> <span class="nx">currentTime</span><span class="p">,</span>
          <span class="nx">d</span><span class="o">:</span> <span class="nx">delay</span>
        <span class="p">});</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Retrieves the parsed expiration data for the storage key</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">getExpirationValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expKey</span> <span class="o">=</span> <span class="nx">createExpirationKey</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
            <span class="nx">expVal</span> <span class="o">=</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">expKey</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">parsed</span><span class="p">(</span><span class="nx">expVal</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Retrieves the expiration delay of the key</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">getExpirationDelay</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expVal</span> <span class="o">=</span> <span class="nx">getExpirationValue</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">expVal</span> <span class="o">&amp;&amp;</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">d</span><span class="p">)</span> <span class="o">?</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">d</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Returns the expiration's creation time in ms</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">getExpirationCreationTime</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expVal</span> <span class="o">=</span> <span class="nx">getExpirationValue</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">expVal</span> <span class="o">&amp;&amp;</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">c</span><span class="p">)</span> <span class="o">?</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">c</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Returns the time remaining (in ms) for the expiration</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">getExpirationTTL</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expVal</span> <span class="o">=</span> <span class="nx">getExpirationValue</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
            <span class="nx">ttl</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">expVal</span> <span class="o">&amp;&amp;</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">d</span> <span class="o">&amp;&amp;</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>TTL is the difference between the creation time w/ delay and now</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">ttl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">expVal</span><span class="p">.</span><span class="nx">c</span> <span class="o">+</span> <span class="nx">expVal</span><span class="p">.</span><span class="nx">d</span><span class="p">)</span> <span class="o">-</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ttl</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Stores expiration data for the passed key</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">setExpirationOf</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">currentTime</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expKey</span> <span class="o">=</span> <span class="nx">createExpirationKey</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
            <span class="nx">expVal</span> <span class="o">=</span> <span class="nx">createExpirationValue</span><span class="p">(</span><span class="nx">delay</span><span class="p">,</span> <span class="nx">currentTime</span><span class="p">);</span>

        <span class="nx">storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">expKey</span><span class="p">,</span> <span class="nx">expVal</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Removes/Cancels the key's expiration</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">removeExpirationOf</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expKey</span> <span class="o">=</span> <span class="nx">createExpirationKey</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
            <span class="nx">expVal</span> <span class="o">=</span> <span class="nx">getExpirationValue</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

        <span class="nx">storage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">expKey</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Whether or not the given key has existing expiration data
Returns:   true if expiry data exists, false otherwise</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">hasExpiration</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expKey</span> <span class="o">=</span> <span class="nx">createExpirationKey</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">!!</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">expKey</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Whether or not the key's ttl indicates that it should be removed</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">shouldExpire</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ttl</span> <span class="o">=</span> <span class="nx">getExpirationTTL</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
            <span class="nx">shouldExpire</span> <span class="o">=</span> <span class="nx">ttl</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">shouldExpire</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Removes a key and its expiration data if the key should expire
Note: Each process is responsible for cleaning out expired keys</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">cleanIfExpired</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">shouldExpire</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">remove</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
          <span class="nx">remove</span><span class="p">(</span><span class="nx">createExpirationKey</span><span class="p">(</span><span class="nx">key</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>/////////////////////////
Native Storage Methods
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">setItem</span> <span class="o">=</span>  <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="nx">fireStorageChangedEvent</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">getItem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Have to clean otherwise we have an expiration loophole</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">cleanIfExpired</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">storage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
    <span class="nx">fireStorageChangedEvent</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">storage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="nx">fireStorageChangedEvent</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>/////////////////////////
Storage Internals
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Redis commands typically have side effects and so we should
be cautious to include calls to those functions when requiring
storage operations with no side effects.
These internal functions are safer to use for storage within commands</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Stores the key/value pair
Note:    Auto-stringifies non-strings
Throws:  Exception on reaching the storage quota</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">store</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span>   <span class="o">=</span> <span class="nx">stringified</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">stringified</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
          <span class="nx">fireStorageChangedEvent</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Quota exception</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Returns the (parsed) value associated with the given key
Note:  to ensure that expired keys are removed,
       we have to do it in core retrieval that all
       other commands use</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">retrieve</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">stringified</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

        <span class="nx">cleanIfExpired</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">parsed</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Remove the key/value pair identified by the passed key
Note:  Auto stringifies non-strings</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">stringified</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="nx">storage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Returns true if the key(s) exists, false otherwise.
Notes:   A key with a set value of null still exists.
Usage:   exists('foo') or exists(['foo', 'bar'])</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">exists</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cleanIfExpired</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">allExist</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
              <span class="nx">allExist</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>localRedis object doesn't hold key/value pairs</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">allExist</span> <span class="o">=</span> <span class="o">!!</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">allExist</span><span class="p">;</span>
      <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>/////////////////////////
Keys Commands
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Removes the specified key(s)
Returns: the number of keys removed.
Notes:   if the key doesn't exist, it's ignored.
         clears existing expirations on the keys
Usage:   del('k1') or del('k1', 'k2') or del(['k1', 'k2'])</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">del</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">numKeysDeleted</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>

    <span class="nx">keys</span> <span class="o">=</span> <span class="p">(</span><span class="nx">keys</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="o">?</span> <span class="nx">keys</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">removeExpirationOf</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="nx">remove</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="o">++</span><span class="nx">numKeysDeleted</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">numKeysDeleted</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Returns: 1 if the key exists, 0 if they key doesn't exist.
Throws:  TypeError if more than one argument is supplied</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">exists</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Renames key to newkey
Throws:  Error if key == newkey
         Error if key does not exist
Usage:   rename(key, newkey)
Notes:   Transfers the key's TTL to the newKey</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">rename</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">errorType</span><span class="p">,</span> <span class="nx">ttl</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">errorType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">errorType</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">errorType</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>errorType could be 0, so don't do if (errorType)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">errorType</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="nx">errorType</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Remove newKey's existing expiration
since newKey inherits all characteristics from key</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">newKey</span><span class="p">))</span> <span class="nx">removeExpirationOf</span><span class="p">(</span><span class="nx">newKey</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Assign the value of key to newKey</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">store</span><span class="p">(</span><span class="nx">newKey</span><span class="p">,</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">key</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Transfer an existing expiration to newKey</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">ttl</span> <span class="o">=</span> <span class="nx">getExpirationTTL</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Transfer the TTL (ms) to the new key</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">pexpire</span><span class="p">(</span><span class="nx">newKey</span><span class="p">,</span> <span class="nx">ttl</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Remove the old key's expiration</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">removeExpirationOf</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">remove</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Renames key to newkey if newkey does not exist
Returns: 1 if key was renamed; 0 if newkey already exists
Usage:   renamenx(key, newkey)
Notes:   Affects expiry like rename
Throws:  TypeError if key == newkey
         ReferenceError if key does not exist
         Fails under the same conditions as rename</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">renamenx</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">typeError</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">typeError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">typeError</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">typeError</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">typeError</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="nx">typeError</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">(</span><span class="nx">newKey</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Rename and transfer expirations</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">newKey</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Retrieves the first key associated with the passed value
Returns:   a single key or
           a list of keys if true is passed as second param or
           null if no keys were found
Params:    all = whether or not to retrieve all of the keys that match
Notes:     Custom, non-redis method</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">getkey</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">all</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Get whether or not the all flag was set</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">all</span> <span class="o">=</span> <span class="o">!!</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Look for keys with a value that matches val</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="nx">v</span> <span class="o">=</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">all</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Return the single element or null if undefined
Otherwise, return the populated array</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">keys</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>expire
Expires the passed key after the passed seconds
Precond: delay in seconds
Returns: 1 if the timeout was set
         0 if the key does not exist or the timeout couldn't be set</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">expire</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Check if the delay is/contains a number</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">delay</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">delay</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">delay</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Convert the delay to ms (1000ms in 1s)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">delay</span> <span class="o">*=</span> <span class="mi">1000</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Subsequent calls to expire on the same key
will refresh the expiration with the new delay</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="nx">removeExpirationOf</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Create the key's new expiration data</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">setExpirationOf</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">());</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Whether or not the key is going to expire
Returns: 1 if the key has expiration data
         0 if the key does not have expiration data
Notes:   Custom function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">expires</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">key</span> <span class="o">=</span> <span class="nx">stringified</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Expiry in milliseconds
Returns: the same output as expire</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">pexpire</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Check if the delay is/contains a number</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">delay</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">delay</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">delay</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Expire will convert the delay to seconds,
so we account for that by canceling out the conversion from ms to s</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">expire</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Expires a key at the supplied, second-based UNIX timestamp
Returns:   1 if the timeout was set.
           0 if key does not exist or the timeout could not be set
Usage:     expireat('foo', 1293840000)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">expireat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Compute the delay (in seconds)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">nowSeconds</span>  <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="nx">delay</span>       <span class="o">=</span> <span class="nx">timestamp</span> <span class="o">-</span> <span class="nx">nowSeconds</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">expire</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Expires a key a the supplied, millisecond-based UNIX timestamp
Returns:   1 if the timeout was set.
           0 if key does not exist or the timeout could not be set</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">pexpireat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Delay in milliseconds</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">delay</span> <span class="o">=</span> <span class="nx">timestamp</span> <span class="o">-</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pexpire</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Removes the expiration associated with the key
Returns:   0 if the key does not exist or does not have an expiration
           1 if the expiration was removed</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">persist</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">key</span><span class="p">)))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">remove</span><span class="p">(</span><span class="nx">createExpirationKey</span><span class="p">(</span><span class="nx">key</span><span class="p">));</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Returns: the time to live in seconds
         -1 when key does not exist or does not have an expiration
Notes:   Due to the possible delay between expiration timeout
         firing and the callback execution, this ttl only reflects
         the TTL for the timeout firing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">ttl</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>1sec = 1000ms</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">getExpirationTTL</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Returns: the time to live in milliseconds
         -1 when key does not exist or does not have an expiration
Note:    this command is just like ttl with ms units</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">pttl</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">ttl</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Returns:   a random key from the calling storage object.
           null when the database is empty</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">randomkey</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keys</span>    <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">storage</span><span class="p">),</span>
        <span class="nx">length</span>  <span class="o">=</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Random position within the list of keys</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">rindex</span>  <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">length</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">rindex</span><span class="p">];</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Returns:   all keys matching the supplied pattern
           null if no keys were found
Usage:     keys('foo*') for all keys with foo</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">pattern</span><span class="p">),</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
        <span class="nx">results</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">storage</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">regex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">results</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>/////////////////////////
String Commands
/////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Returns: The (parsed) value associated with the passed key, if it exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Stores the passed value indexed by the passed key
Notes:   Auto stringifies
         resets an existing expiration if set was called directly
Usage:   set('foo', 'bar') or set('foo', 'bar').set('bar', 'car')</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hasExp</span> <span class="o">=</span> <span class="nx">hasExpiration</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
        <span class="nx">expDelay</span><span class="p">;</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Cancel the expiration of the key</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">hasExp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">expDelay</span> <span class="o">=</span> <span class="nx">getExpirationDelay</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">persist</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Makes chainable</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Sets key to value and returns the old value stored at key
Throws:  Error when key exists but does not hold a string value
Usage:   getset(key, value)
Notes:   Removes an existing expiration for key
Returns: the old value stored at key or null when the key does not exist</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">getset</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Grab the existing value or null if the key doesn't exist</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">oldVal</span> <span class="o">=</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Throw an exception if the value isn't a string</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">oldVal</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Use set to refresh an existing expiration</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">oldVal</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Returns: A list of values for the passed key(s).
Note:    Values match keys by index.
Usage:   mget('key1', 'key2', 'key3') or mget(['key1', 'key2', 'key3'])</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">mget</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Determine the form of the parameters</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">keys</span> <span class="o">=</span> <span class="p">(</span><span class="nx">keys</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="o">?</span> <span class="nx">keys</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Retrieve the value for each key</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">results</span><span class="p">[</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Allows the setting of multiple key value pairs
Usage:   mset('key1', 'val1', 'key2', 'val2') or
         mset(['key1', 'val1', 'key2', 'val2']) or
         mset({key1: val1, key2: val2})
Notes:   If there's an odd number of elements,
         unset values default to undefined.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">mset</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keysVals</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isArray</span>   <span class="o">=</span> <span class="nx">keysVals</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">,</span>
        <span class="nx">isObject</span>  <span class="o">=</span> <span class="nx">keysVals</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
        <span class="nx">keys</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Arrays are both an array and an object
but an object is solely an object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">isObject</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isArray</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">keysVals</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">store</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">keysVals</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]]);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="nx">keysVals</span> <span class="o">=</span> <span class="nx">isArray</span> <span class="o">?</span> <span class="nx">keysVals</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keysVals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">store</span><span class="p">(</span><span class="nx">keysVals</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">keysVals</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Set key to hold string value if key does not exist.
Returns:   1 if the key was set
           0 if the key was not set
Note:      When key already holds a value, no operation is performed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">setnx</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Sets the given keys to their respective values.
Returns:   1 if the all the keys were set.
           0 if no key was set (at least one key already existed).
Notes:     Accepts the same types of params as mset.
           If just a single key already exists,
           no set operations are performed</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">msetnx</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keysVals</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isArray</span> <span class="o">=</span> <span class="nx">keysVals</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">,</span>
        <span class="nx">isObject</span> <span class="o">=</span> <span class="nx">keysVals</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
        <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Grab all of the keys</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">isObject</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">isArray</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">keysVals</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">keysVals</span> <span class="o">=</span> <span class="nx">isArray</span> <span class="o">?</span> <span class="nx">keysVals</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keysVals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">keysVals</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>If any key exists, then don't store anything</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>We don't call mset because splat arguments
are passed in as an object, when it should be
processed like an array</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keysVals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">store</span><span class="p">(</span><span class="nx">keysVals</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">keysVals</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>If the key does not exist, incr sets it to 1
Note:  incr does not affect expiry</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">incr</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">incrby</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>If the key does not exist, incrby sets it to amount
Notes:   Incrby does not affect key expiry
         keys set with null values cannot be incremented
         amount must be a number or string containing a number
Usage:   incrby('foo', '4') or incrby('foo', 4)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">incrby</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">value</span>                <span class="o">=</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
        <span class="nx">valType</span>              <span class="o">=</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">,</span>
        <span class="nx">amountType</span>           <span class="o">=</span> <span class="k">typeof</span> <span class="nx">amount</span><span class="p">,</span>
        <span class="nx">parsedValue</span>          <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="nx">parsedAmount</span>         <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">amount</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="nx">amountIsNaN</span>          <span class="o">=</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">parsedAmount</span><span class="p">),</span>
        <span class="nx">valueIsNaN</span>           <span class="o">=</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">parsedValue</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Check the value</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">isValNull</span>            <span class="o">=</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">isValNumber</span>          <span class="o">=</span> <span class="nx">isNumber</span><span class="p">(</span><span class="nx">valType</span><span class="p">),</span>
        <span class="nx">isValNumberStr</span>       <span class="o">=</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">valType</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">valueIsNaN</span><span class="p">,</span>
        <span class="nx">isValNotNumberStr</span>    <span class="o">=</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">valType</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">valueIsNaN</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Value should be a number or string representation of a number
Example values: 1 or "1"</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">isValNotValid</span>        <span class="o">=</span> <span class="o">!</span><span class="nx">isValNumber</span> <span class="o">&amp;&amp;</span> <span class="nx">isValNotNumberStr</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Key exists with a value of null</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">existsNullVal</span>        <span class="o">=</span> <span class="nx">valueIsNaN</span> <span class="o">&amp;&amp;</span> <span class="nx">exists</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Check the amount</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">isAmountNumber</span>       <span class="o">=</span> <span class="nx">isNumber</span><span class="p">(</span><span class="nx">amountType</span><span class="p">),</span>
        <span class="nx">isAmountNumberStr</span>    <span class="o">=</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">amountType</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">amountIsNaN</span><span class="p">,</span>
        <span class="nx">isAmountNotNumberStr</span> <span class="o">=</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">amountType</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">amountIsNaN</span><span class="p">,</span>
        <span class="nx">isAmountNotValid</span>     <span class="o">=</span> <span class="o">!</span><span class="nx">isAmountNumber</span> <span class="o">&amp;&amp;</span> <span class="nx">isAmountNotNumberStr</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Out of range checks</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">valOutOfRange</span>        <span class="o">=</span> <span class="o">!</span><span class="nx">valueIsNaN</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">),</span>
        <span class="nx">amountOutOfRange</span>     <span class="o">=</span> <span class="o">!</span><span class="nx">amountIsNaN</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&gt;=</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">),</span>
        <span class="nx">anyOutOfRange</span>        <span class="o">=</span> <span class="nx">valOutOfRange</span> <span class="o">||</span> <span class="nx">amountOutOfRange</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">isValNotValid</span>  <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isValNull</span><span class="p">)</span> <span class="o">||</span> <span class="nx">existsNullVal</span> <span class="o">||</span> <span class="nx">amountIsNaN</span> <span class="o">||</span> <span class="nx">isAmountNotValid</span> <span class="o">||</span> <span class="nx">anyOutOfRange</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>out of range or not an integer</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>The value and incr amount are valid</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">isValNumber</span> <span class="o">||</span> <span class="nx">isValNumberStr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">isAmountNumber</span> <span class="o">||</span> <span class="nx">isAmountNumberStr</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">parsedValue</span> <span class="o">+</span> <span class="nx">parsedAmount</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Key didn't exist, so set the value to the amount</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isAmountNumber</span> <span class="o">||</span> <span class="nx">isAmountNumberStr</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">parsedAmount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Increments multiple keys by 1</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">mincr</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>
    <span class="nx">keys</span> <span class="o">=</span> <span class="p">(</span><span class="nx">keys</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="o">?</span> <span class="nx">keys</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">incr</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Usage:   mincrby('key1', 1, 'key2', 4) or
         mincrby(['key1', 1, 'key2', 2]) or
         mincrby({'key1': 1, 'key2': 2})
Notes:   Custom, non-redis method</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">mincrby</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keysAmounts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">key</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">keysAmounts</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="o">||</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">keysAmounts</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">keysAmounts</span> <span class="o">=</span> <span class="p">(</span><span class="nx">keysAmounts</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="o">?</span> <span class="nx">keysAmounts</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Need to make sure an even number of arguments is passed in</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">((</span><span class="nx">keysAmounts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">keysAmounts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">incrby</span><span class="p">(</span><span class="nx">keysAmounts</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">keysAmounts</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">keysAmounts</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">keysAmounts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">incrby</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">keysAmounts</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>decr</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>decrby</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>mdecrby</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Appends the value at the end of the string
Returns: the length of the string after appending
         the original length for non-string values
Notes:   Appends if the key exists and is a string
         If key does not exist, we initialize it to empty
         and perform the append</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">append</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">val</span>         <span class="o">=</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">valIsString</span> <span class="o">=</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">valIsString</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">val</span> <span class="o">+=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="nx">store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">valIsString</span> <span class="o">?</span> <span class="nx">val</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Returns: the length of the string value stored at key.
         0 when key does not exist
Throws:  when the key holds a non-string value</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">strlen</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">val</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Set key to hold the string value and set key to
timeout after a given number of seconds.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">setex</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="nx">store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">expire</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Set key to hold the string value and set key to
timeout after a given number of milliseconds.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">localRedis</span><span class="p">.</span><span class="nx">psetex</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">generateError</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="nx">store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pexpire</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">delay</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nb">window</span><span class="p">.</span><span class="nx">localRedis</span> <span class="o">=</span> <span class="nx">localRedis</span><span class="p">;</span>

<span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 