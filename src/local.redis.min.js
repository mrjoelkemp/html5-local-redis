var LocalRedis=LocalRedis||{};LocalRedis.Utils=LocalRedis.Utils||{};
(function(i,e){if(i.localStorage){var d=i.localStorage.constructor.prototype;d._store=function(a,b){a="string"!==typeof a?JSON.stringify(a):a;b="string"!==typeof b?JSON.stringify(b):b;try{this.setItem(a,b)}catch(c){if(c===QUOTA_EXCEEDED_ERR)throw c;}};d._retrieve=function(a){a="string"!==typeof a?JSON.stringify(a):a;a=this.getItem(a);try{a=JSON.parse(a)}catch(b){}finally{return a}};d._remove=function(a){a="string"!==typeof a?JSON.stringify(a):a;this.removeItem(a)};d._exists=function(a){var b=!0,c,
f;if(a instanceof Array){c=0;for(f=a.length;c<f;c++)this.hasOwnProperty(a[c])||(b=!1)}else b=!!this.hasOwnProperty(a);return b};d.del=function(a){var b=0,c,f,a=a instanceof Array?a:arguments;c=0;for(f=a.length;c<f;c++)this._exists(a[c])&&(e.removeExpirationOf(a[c],this),this._remove(a[c]),++b);return b};d.exists=function(a){if(1<arguments.length)throw new TypeError("exists: wrong number of arguments");return this._exists(a)?1:0};d.rename=function(a,b){if(2!==arguments.length)throw new TypeError("rename: wrong number of arguments");
if(a===b)throw new TypeError("rename: source and destination objects are the same");if(!this._exists(a))throw new ReferenceError("rename: no such key");e.hasExpiration(b,this)&&e.removeExpirationOf(b,this);var c=this._retrieve(a);this._store(b,c);e.hasExpiration(a,this)&&(c=e.getExpirationTTL(a,this),this.pexpire(b,c),e.removeExpirationOf(a,this));this._remove(a)};d.renamenx=function(a,b){if(2!==arguments.length)throw new TypeError("renamenx: wrong number of arguments");if(a===b)throw new TypeError("renamenx: source and destination objects are the same");
if(!this._exists(a))throw new ReferenceError("renamenx: no such key");if(this._exists(b))return 0;var c=this._retrieve(a);this._store(b,c);this._remove(a);return 1};d.getkey=function(a){if(2<arguments.length)throw new TypeError("getkey: wrong number of arguments");var b,c,f,d,e=[],g;g=!!arguments[1];b=0;for(c=this.length;b<c&&!(f=this.key(b),d=this.getItem(f),a===d&&(e.push(f),!g));b++);1===e.length?e=e[0]:e.length||(e=null);return e};d.expire=function(a,b){if(2!==arguments.length)throw new TypeError("expire: wrong number of arguments");
var c=e.createExpirationKey(a),f=this,d;if(b=parseFloat(b,10)){if(!this._exists(a))return 0}else throw new TypeError("expire: delay should be convertible to a number");b*=1E3;d=setTimeout(function(){f._remove(a);f._remove(c)},b);if(!d)return 0;e.hasExpiration(a,this)&&e.removeExpirationOf(a,this);e.setExpirationOf(a,d,b,(new Date).getTime(),this);return 1};d.pexpire=function(a,b){if(2!==arguments.length)throw new TypeError("pexpire: wrong number of arguments");b=parseFloat(b,10);if(!b)throw new TypeError("pexpire: delay should be convertible to a number");
return this.expire(a,b/1E3)};d.expireat=function(a,b){if(2!==arguments.length)throw new TypeError("expireat: wrong number of arguments");var c=(new Date).getTime()/1E3,c=b-c;if(0>c)throw Error("expireat: timestamp already passed");return this.expire(a,c)};d.pexpireat=function(a,b){if(2!==arguments.length)throw Error("pexpireat: wrong number of arguments");var c=b-(new Date).getTime();if(0>c)throw Error("pexpireat: timestamp already passed");return this.pexpire(a,c)};d.persist=function(a){if(1!==arguments.length)throw new TypeError("persist: wrong number of arguments");
if(!this._exists(a)||!e.hasExpiration(a,this))return 0;clearTimeout(e.getExpirationID(a,this));this._remove(e.createExpirationKey(a));return 1};d.ttl=function(a){if(1!==arguments.length)throw new TypeError("ttl: wrong number of arguments");return!this._exists(a)||!e.hasExpiration(a,this)?-1:e.getExpirationTTL(a,this)/1E3};d.pttl=function(a){if(1!==arguments.length)throw new TypeError("pttl: wrong number of arguments");return 1E3*this.ttl(a)};d.randomkey=function(){var a=Object.keys(this),b=this.length,
c=Math.floor(Math.random()*b);return!b?null:a[c]};d.keys=function(a){var a=RegExp(a),b,c,d=[],e=Object.keys(this);b=0;for(c=e.length;b<c;b++)a.test(e[b])&&d.push(e[b]);return d};d.get=function(a){return this._retrieve(a)};d.set=function(a,b){var c=e.hasExpiration(a,this);try{this._store(a,b),c&&(e.getExpirationDelay(a,this),this.persist(a))}catch(d){throw d;}return this};d.getset=function(a,b){if(2!==arguments.length)throw new TypeError("getset: wrong number of arguments");var c=this._retrieve(a);
if("string"!==typeof c&&null!==c)throw Error("getset: not a string value");this.set(a,b);return c};d.mget=function(a){var b=[],c,d,a=a instanceof Array?a:arguments;c=0;for(d=a.length;c<d;c++)b[b.length]=this._retrieve(a[c]);return b};d.mset=function(a){var b=a instanceof Array,c,d;if(a instanceof Object&&!b){d=Object.keys(a);b=0;for(c=d.length;b<c;b++)this._store(d[b],a[d[b]])}else{a=b?a:arguments;b=0;for(c=a.length;b<c;b+=2)this._store(a[b],a[b+1])}return this};d.setnx=function(a,b){if(2!==arguments.length)throw new TypeError("setnx: wrong number of arguments");
if(this._exists(a))return 0;this._store(a,b);return 1};d.msetnx=function(a){var b=a instanceof Array,c,d=[];if(a instanceof Object&&!b)d=Object.keys(a);else{a=b?a:arguments;b=0;for(c=a.length;b<c;b+=2)d.push(a[b])}b=0;for(c=d.length;b<c;b++)if(this._exists(d[b]))return 0;b=0;for(c=a.length;b<c;b+=2)this._store(a[b],a[b+1]);return 1};d.getset=function(a,b){var c=this._retrieve(a);if("string"!==typeof c&&null!==c)throw Error("getset: not a string value");this.set(a,b);return c};d.incr=function(a){if(1!==
arguments.length)throw new TypeError("incr: wrong number of arguments");var b=this._retrieve(a),c=typeof b,d=parseInt(b,10),e=isNaN(d),j="number"===c,g="string"===c&&!e,h=!1;!e&&b>=Number.MAX_VALUE&&(h=!0);if(!j&&"string"===c&&e||h||e&&this.hasOwnProperty(a))throw new TypeError("incr: value is not an integer or out of range");this._store(a,j||g?d+1:1)};d.incrby=function(a,b){if(2!==arguments.length)throw new TypeError("incrby: wrong number of arguments");var c=this._retrieve(a),d=typeof c,e=typeof b,
j=parseInt(c,10),g=parseInt(b,10),h=isNaN(g),k=isNaN(j),i="number"===d,l="number"===e,o="string"===d&&!k,m="string"===e&&!h,e="string"===e&&h,n=!1;if(!k&&c>=Number.MAX_VALUE||!h&&b>=Number.MAX_VALUE)n=!0;if(!i&&"string"===d&&k||k&&this.hasOwnProperty(a)||h||!l&&e||n)throw new TypeError("incrby: value is not an integer or out of range");if((i||o)&&(l||m))c=j+g;else if(l||m)c=g;this._store(a,c)};d.mincr=function(a){var b,c,a=a instanceof Array?a:arguments;b=0;for(c=a.length;b<c;b++)this.incr(a[b])};
d.mincrby=function(a){var b,c;if(a instanceof Array||"string"===typeof a){a=a instanceof Array?a:arguments;if(0!==(a.length&1))throw new TypeError("mincrby: wrong number of arguments");b=0;for(c=a.length;b<c;b+=2)this.incrby(a[b],a[b+1])}else if(a instanceof Object)for(b in a)this.incrby(b,a[b])};d.append=function(a,b){var c=this._exists(a)?this._retrieve(a):"",d="string"===typeof c;d&&(c+=b,this._store(a,c));return d?c.length:1};d.strlen=function(a){a=this._retrieve(a);if(!a)return 0;if("string"===
typeof a)return a.length;throw Error("strlen: non-string value");};d.setex=function(a,b,c){if(3!==arguments.length)throw new TypeError("setex: wrong number of arguments");this._store(a,b);this.expire(a,c)};d.psetex=function(a,b,c){if(3!==arguments.length)throw new TypeError("psetex: wrong number of arguments");this._store(a,b);this.pexpire(a,c)}}})(window,LocalRedis.Utils.Expiration);
